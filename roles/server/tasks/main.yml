---
- name: Install required packages
  apt:
    name:
      - apache2
      - git
      - php
      - php-pgsql
    state: present
    update_cache: yes

- name: Clone the Laravel application
  git:
    repo: "https://github.com/Practical-DevOps/app-for-devops.git"
    dest: /var/www/app
    version: main

- name: Copy Apache virtual host config
  template:
    src: apache.conf.j2
    dest: /etc/apache2/sites-available/app.conf

- name: Enable site
  shell: |
    a2ensite app.conf
    a2enmod rewrite

- name: Restart Apache
  systemd:
    name: apache2
    state: restarted
